<project
    name="testregex"
    default="testregex"
    basedir=".">
    <property
        name="bundleVersion"
        value="3.8.1.N20120718-1624" />
    <target
        name="testregex"
        depends="init">

        <echo message="bundleVersion: ${bundleVersion}" />
        <echo message="bundleVersionMajor: ${bundleVersionMajor}" />
        <echo message="bundleVersionMinor: ${bundleVersionMinor}" />
        <echo message="bundleVersionService: ${bundleVersionService}" />
        <echo message="bundleVersionQualifier: ${bundleVersionQualifer}" />

    </target>


    <!--
       main purpose of init, it to be sure we have bundleVersionMajor and bundleVersionMinor
       Uses script, which requires Java 1.6 (or ... else gets complicated to setup)
     -->
    <target name="init">
        <fail
            unless="bundleVersion"
            message="bundleVersion must be provided by caller" />
        <condition property="streamOK">
            <matches
                pattern="\d\.\d\.\d\..*"
                string="${bundleVersion}" />
        </condition>
        <fail
            message="bundleVersion variable had unexpected format. Should be digit.digit.digit,ANY but was ${bundleVersion}"
            unless="streamOK" />

        <script language="javascript">
            var bundleVersion = project.getProperty("bundleVersion");
            var pattern = new RegExp(/^(\d+)\.(\d+)\.(\d+)\.(.*)$/);

            var sArray = pattern.exec(bundleVersion);
            // sArray 0 is "whole match"
            project.setProperty("bundleVersionMajor", sArray[1]);
            project.setProperty("bundleVersionMinor", sArray[2]);
            project.setProperty("bundleVersionService", sArray[3]);
            project.setProperty("bundleVersionQualifer", sArray[4]);
        </script>


    </target>

</project>