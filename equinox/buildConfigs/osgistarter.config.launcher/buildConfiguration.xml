<project name="org.eclipse.osgi.configuration" default="main" basedir=".">

	<target name="main">
		<property name="product" value="${basedir}/config.product" />
		<property name="id" value="org.eclipse.pde.build.container.feature" />
		<property name="type" value="feature" />
		<property name="verify" value="false" />
		<delete dir="${basedir}/temp" />

		<path id="launcher.paths">
			<fileset dir="${reposource}" includes="plugins/org.eclipse.equinox.launcher*" />
			<!-- the built version of the org.eclipse.equinox.executable feature -->
			<dirset dir="${buildDirectory}" includes="features/org.eclipse.equinox.executable*" />
        	<dirset dir="${buildDirectory}" includes="features/org.eclipse.license*" />
		</path>

		<!-- generate a feature based on our .product file -->
		<property file="${eclipse.build.configs}/master/build.properties" />
		<ant antfile="${eclipse.pdebuild.scripts}/productBuild/productBuild.xml" target="generateFeature">
			<property name="nestedInclusions" value="false" />
			<property name="buildDirectory" value="${basedir}/temp" />
		</ant>
		<!-- generate product build scripts for the generated feature -->
		<ant antfile="${eclipse.pdebuild.scripts}/genericTargets.xml" target="generateScript">
			<property name="buildDirectory" value="${basedir}/temp" />
			<property name="baseLocation" value="" />
			<property name="transformedRepoLocation" value="" />
			<property name="pluginPath" refid="launcher.paths" />
			<property name="forceContextQualifier" value="${buildId}" />
		</ant>

		<!-- get the generate p2.inf that got generated with the above scripts -->
		<copy file="${basedir}/temp/features/org.eclipse.pde.build.container.feature/product/p2.inf" tofile="${basedir}/p2.inf" overwrite="true" />
		<replace file="${basedir}/p2.inf" token="@FLAVOR@" value="tooling" />

		<!-- publish the configuration feature with the generated p2.inf -->
		<replace file="${basedir}/feature.xml" token="@qualifier@" value="${buildId}" />
		<eclipse.gatherFeature metadataRepository="file:${reposource}" artifactRepository="file:${reposource}" buildResultFolder="${basedir}" baseDirectory="${basedir}" />
		<p2.remove.iu>
			<repository location="file://${reposource}" />
			<iu id="org.eclipse.osgi.configuration_root.win32.win32.x86" />
			<iu id="org.eclipse.osgi.configuration_root.win32.win32.x86_64" />
			<iu id="org.eclipse.osgi.configuration_root.gtk.linux.x86" />
			<iu id="org.eclipse.osgi.configuration_root.gtk.linux.x86_64" />
			<iu id="org.eclipse.osgi.configuration_root.gtk.linux.ppc64" />
			<iu id="org.eclipse.osgi.configuration_root.gtk.linux.s390x" />
			<iu id="org.eclipse.osgi.configuration_root.gtk.linux.s390" />
			<iu id="org.eclipse.osgi.configuration_root.gtk.solaris.sparc" />
			<iu id="org.eclipse.osgi.configuration_root.gtk.solaris.x86" />
			<iu id="org.eclipse.osgi.configuration_root.gtk.aix.ppc" />
			<iu id="org.eclipse.osgi.configuration_root.gtk.aix.ppc64" />
			<iu id="org.eclipse.osgi.configuration_root.gtk.hpux.ia64_32" />	
			<iu id="org.eclipse.osgi.configuration_root.cocoa.macosx.x86" />
			<iu id="org.eclipse.osgi.configuration_root.cocoa.macosx.x86_64" />
		</p2.remove.iu>
	</target>
</project>
