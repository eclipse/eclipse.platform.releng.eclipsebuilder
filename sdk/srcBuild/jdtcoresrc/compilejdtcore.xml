<?xml version="1.0" encoding="UTF-8"?>

<!-- build script to create a batch compiler from org.eclipse.jdt.core -->
<project name="Compile ecj" default="compile">
	<target name="init">
		<tstamp/>
		<property name="destdir" value="compiler2" />
        <property name="srcdir" value="src" />
	</target>

	<target name="compile" depends="init">

		<echo message="TARGET: ${destdir}" />
		<delete dir="${destdir}"/>
		<mkdir dir="${destdir}"/>

                <condition property="build.compiler" value="org.eclipse.jdt.core.JDTCompilerAdapter">
                        <available file="ecj.jar" />
                </condition> 
				<fail message="The Eclipse compiler (ecj.jar) cannot be found.">
					<condition>
						<not>
							<equals arg1="${build.compiler}" arg2="org.eclipse.jdt.core.JDTCompilerAdapter" />
						</not>
					</condition>
				</fail>
		
                <condition property="compilerArg" value="-encoding ISO-8859-1">
                        <equals arg1="${build.compiler}" arg2="org.eclipse.jdt.core.JDTCompilerAdapter" />
	            </condition>  
		
                <echo message="compilerArg ${compilerArg}"/>
                <echo message="build compiler ${build.compiler}"/>

                <property name="compilerArg" value="-encoding ISO-8859-1" />
                <property name="javacSource" value="1.3" />
                <property name="javacTarget" value="1.2" />
                <property name="javacDebugInfo" value="on" />
                <property name="javacFailOnError" value="true" />
                <record name="compilelog2.txt" action="start" />
                <javac verbose="true"
                	   target="${javacTarget}"
                       source="${javacSource}"
					   srcdir="${srcdir}" 
					   destdir="${destdir}"
               		   debug="${javacDebugInfo}"
               		   failonerror="${javacFailOnError}">
       		    <compilerarg line="${compilerArg}"/>
      	        </javac>
                <record name="compilelog2.txt" action="stop" />                                                                                                                  
            
                <echo message="UPDATE ecj.jar" />
                <copy todir="${destdir}">
                        <fileset dir="${srcdir}">
                             <include name="**/*.properties"/>
                             <include name="**/*.rsc"/>
                        </fileset>
                        </copy>

                <jar jarfile="../ecj.jar">
                        <fileset dir="${destdir}"/>
                </jar>

	</target>
</project>
