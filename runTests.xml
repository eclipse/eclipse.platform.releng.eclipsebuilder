<project default="main">

	<target name="init">
		<property name="buildId" value="I20101027-1800" />
		<property name="os" value="win32" />
		<property name="ws" value="win32" />
		<property name="arch" value="x86_64" />
		<echo message="WORKSPACE ${WORKSPACE}" />
		<echo message="BUILD_ID ${BUILD_ID}" />
		<property name="testDir" value="${WORKSPACE}\${BUILD_ID}" />
		<echo message="testDir ${testDir}" />
		<property name="executionDir" value="${testDir}/eclipse-testing" />
		<mkdir dir="${executionDir}" />
		<echo message="executionDir ${executionDir}" />
		<echo message="hudson ${hudson}" />
	</target>

	<target name="getwin7zips">
		<get src="http://download.eclipse.org/eclipse/downloads/drops/${buildId}/eclipse-SDK-${buildId}-win32.zip" dest="${executionDir}/eclipse-SDK-${buildId}-win32.zip" />
		<get src="http://download.eclipse.org/eclipse/downloads/drops/${buildId}/eclipse-Automated-Tests-${buildId}.zip" dest="${testDir}/eclipse-Automated-Tests-${buildId}.zip" />
		<get src="http://download.eclipse.org/eclipse/downloads/drops/${buildId}/eclipse-platform-${buildId}-win32.zip" dest="${executionDir}/eclipse-platform-${buildId}-win32.zip" />
		<get src="http://download.eclipse.org/eclipse/downloads/drops/${buildId}/eclipse-${buildId}-delta-pack.zip" dest="${executionDir}/eclipse-${buildId}-delta-pack.zip" />
		<get src="http://download.eclipse.org/eclipse/downloads/drops/${buildId}/eclipse-Automated-Tests-${buildId}.zip" dest="${executionDir}/eclipse-Automated-Tests-${buildId}.zip" />
		<get src="http://download.eclipse.org/eclipse/downloads/drops/R-3.6-201006080911/eclipse-platform-3.6-win32.zip" dest="${executionDir}/eclipse-platform-3.6-win32.zip" />
	</target>

	<target name="getlinuxzips">
		<get src="http://download.eclipse.org/eclipse/downloads/drops/${buildId}/eclipse-SDK-${buildId}-linux-gtk-x86_64.zip" dest="${executionDir}/eclipse-SDK-${buildId}-linux-gtk-x86_64.zip" />
		<get src="http://download.eclipse.org/eclipse/downloads/drops/${buildId}/eclipse-Automated-Tests-${buildId}.zip" dest="${testDir}/eclipse-Automated-Tests-${buildId}.zip" />
		<get src="http://download.eclipse.org/eclipse/downloads/drops/${buildId}/eclipse-platform-${buildId}-linux-gtk-x86_64.zip" dest="${executionDir}/eclipse-platform-${buildId}-linux-gtk-x86_64.zip" />
		<get src="http://download.eclipse.org/eclipse/downloads/drops/${buildId}/eclipse-${buildId}-delta-pack.zip" dest="${executionDir}/eclipse-${buildId}-delta-pack.zip" />
		<get src="http://download.eclipse.org/eclipse/downloads/drops/${buildId}/eclipse-Automated-Tests-${buildId}.zip" dest="${executionDir}/eclipse-Automated-Tests-${buildId}.zip" />
		<get src="http://download.eclipse.org/eclipse/downloads/drops/R-3.6-201006080911/eclipse-platform-3.6-linux-gtk-x86_64.zip" dest="${executionDir}/eclipse-platform-3.6-linux-gtk-x86_64.zip" />
	</target>

	<target name="main" depends="init">
		<property name="test.xml" value="../org.eclipse.releng.basebuilder/plugins/org.eclipse.build.tools/scripts/test.xml" />
		<condition property="${testPlatform}" value="win7">
			<and>
				<os family="windows" />
				<os arch="x86" />
			</and>
		</condition>
		<property name="${testPlatform}" value="linux"/>
		<!--<condition property="${testPlatform}" value="linux">
			 <and>
				<os family="unix" />
				 <or>
					<os arch="amd64" />					
				</or> 
			</and> 
		</condition> -->
		<echo message="testPlatform  ${testPlatform}"/>
		<echo message="os.arch ${os.arch}"/>
		<echo message="os.name ${os.name}"/>
		<antcall target="get${testPlatform}zips"/>
		<property file="eclipse/buildConfigs/sdk.tests/testConfigs/${testPlatform}/testing.properties" />
		<property name="tester" value="${executionDir}" />
		<replace file="eclipse/buildConfigs/sdk.tests/testConfigs/${testPlatform}/equinoxp2tests.properties" token="@testDir@" value="${testDir}" />
		<copy todir="${executionDir}">
			<fileset dir="eclipse/buildConfigs/sdk.tests/testConfigs/${testPlatform}" />
		</copy>
		<copy todir="${executionDir}" overwrite="true">
			<fileset dir="eclipse/buildConfigs/sdk.tests/testScripts" />
		</copy>
		<ant antfile="${test.xml}" />
	</target>

</project>
