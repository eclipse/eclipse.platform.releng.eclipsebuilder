<project
    name="Helper targets"
    default="generateEclipseIndex"
    basedir=".">

    <fail unless="buildId" />
    <fail unless="eclipseStream" />
    <fail unless="buildType" />
    <!-- 
        TODO: make less exactly hard coded in future
        also, check for validity using "matches" digit*\.digit*\.digit*
    -->
    <condition
        property="eclipseStreamMajor"
        value="4"
        else="3">
        <equals
            arg1="${eclipseStream}"
            arg2="4.2.0" />
    </condition>
                
      <!-- 
        TODO: make less exactly hard coded in future
         also, check for validity using "matches" digit*\.digit*\.digit*
      -->
    <condition
        property="dropsDirSegment"
        value="drops4"
        else="drops">
        <equals
            arg1="${eclipseStream}"
            arg2="4.2.0" />
    </condition>

    <property name="buildRoot" value="/shared/eclipse/eclipse${eclipseStreamMajor}${buildType}"/>

    
    <property
        name="postingDirectory"
        value="${buildRoot}/siteDir/eclipse/downloads/${dropsDirSegment}" />
    <property
        name="builderDir"
        value="${buildRoot}/build/supportDir/org.eclipse.releng.eclipsebuilder" />
    <property
        name="publishingContent"
        value="${buildRoot}/build/supportDir/org.eclipse.releng.eclipsebuilder/eclipse/publishingFiles" />
    <property
        name="base.builder"
        value="${buildRoot}/build/supportDir/org.eclipse.releng.basebuilder" />

    <property
        name="buildLabel"
        value="${buildId}" />
    <property
        name="eclipse.build.configs"
        value="${builderDir}/eclipse/buildConfigs" />
    <property
        name="buildDirectory"
        value="${basedir}/../src" />

    <target name="generateEclipseIndex">
        <condition
            property="generatorClass"
            value="org.eclipse.releng.generators.EclipseTestResultsGeneratorNoMail">
            <equals
                arg1="${hudson}"
                arg2="true" />
        </condition>
        <property
            name="generatorClass"
            value="org.eclipse.releng.generators.EclipseTestResultsGenerator" />

        <available
            classname="${generatorClass}"
            property="class"
            value="${generatorClass}" />
        <echoproperties />
        <!--regenerate the index page with links to test results -->
        <ant
            antfile="${builderDir}/eclipse/helpernew.xml"
            dir="${publishingContent}"
            target="generateEclipseIndex">

            <property
                name="isBuildTested"
                value="true" />
            <property
                name="buildType"
                value="${buildType}" />
            <property
                name="dropTokenList"
                value="%sdk%,%tests%,%example%,%rcpruntime%,%rcpsdk%,%deltapack%,%icubase%,%runtime%,%jdt%,%jdtsdk%,%jdtc%,%jarprocessor%,%pde%,%pdesdk%,%cvs%,%cvssdk%,%swt%,%relengtools%" />
            <property
                name="platformIdentifierToken"
                value="%platform%" />
            <property
                name="platformSpecificTemplateList"
                value="Windows,${publishingContent}/templateFiles/platform.php.template,winPlatform.php;Linux,${publishingContent}/templateFiles/platform.php.template,linPlatform.php;Solaris,${publishingContent}/templateFiles/platform.php.template,solPlatform.php;AIX,${publishingContent}/templateFiles/platform.php.template,aixPlatform.php;Macintosh,${publishingContent}/templateFiles/platform.php.template,macPlatform.php;HP-UX,${publishingContent}/templateFiles/platform.php.template,hpuxPlatform.php" />
            <property
                name="indexFileName"
                value="index.php" />
            <property
                name="result"
                value="${postingDirectory}/${buildId}" />
            <property
                name="testResultsTemplateFileName"
                value="${publishingContent}/templateFiles/testResults.php.template" />
            <property
                name="dropTemplateFileName"
                value="${publishingContent}/templateFiles/index.php.template" />
            <property
                name="testManifestFileName"
                value="${publishingContent}/testManifest.xml" />
        </ant>

    </target>



</project>
