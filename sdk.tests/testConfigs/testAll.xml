<project name="Eclipse Test Configuration" default="all" basedir=".">

<!--
	Ant properties for buildId, buildLabel, timestamp and buildDirectory must be set before running this script.
-->
<property name="markerContainer" value="/home/users/releng/buildTools/markers" />
<property name="cfg" value="${markerContainer}/machine.cfg" />
<property name="test.xml" value="${basedir}/../../../org.eclipse.releng.basebuilder/plugins/org.eclipse.build.tools/scripts/test.xml" />
		
<target name="all">
	<parallel>
		<antcall target="testLinuxGTK"/>
		<antcall target="testWinXP" />
	</parallel>
</target>

<target name="performanceTests">
	<parallel>
		<antcall target="testWinXPPerf" />
		<antcall target="testLinuxGTKPerf" />
		<antcall target="testWinXPPerf2" />
		<antcall target="testLinuxGTKPerf2" />
	</parallel>
	<echo message="Performance testing complete." />
</target>
	
<target name="testLinuxGTK">
	<property name="markerName" value="eclipse30-linux-gtk-${timestamp}" />
	<findMachine cfg="${cfg}" markerContainer="${markerContainer}" cfgKey="eclipse30LinuxGtkTest" markerName="${markerName}" waitInterval="30"/>
	<property file="${markerContainer}/${markerName}.marker" />
	<property name="testMachine" value="${0}" />
	
	<ant antfile="${test.xml}">
		<property name="tester" value="${basedir}/rhelws3-linux-gtk" />
	</ant>
	
	<delete file="${markerContainer}/${markerName}.marker" />
</target>

<target name="testWinXP">
	<property name="markerName" value="eclipse30-winxp-${timestamp}" />
	<findMachine cfg="${cfg}" markerContainer="${markerContainer}" cfgKey="eclipse30WinXPTest" markerName="${markerName}" waitInterval="30"/>
	<property file="${markerContainer}/${markerName}.marker" />
	<property name="testMachine" value="${0}" />
	
	<ant antfile="${test.xml}">
		<property name="tester" value="${basedir}/win32" />
	</ant>
	<delete file="${markerContainer}/${markerName}.marker" />
</target>

<target name="testWinXPPerf">
	<property name="testResults" value="${postingDirectory}/${buildLabel}/performance" />
	<mkdir dir="${testResults}"/>
	<property name="markerName" value="eclipse30-winxp-perf-${timestamp}" />
	<findMachine cfg="${cfg}" markerContainer="${markerContainer}" cfgKey="eclipse30WinXPTestPerf" markerName="${markerName}" waitInterval="30"/>
	<property file="${markerContainer}/${markerName}.marker" />
	<property name="testMachine" value="${0}" />
	<ant antfile="${test.xml}">
		<property name="tester" value="${basedir}/win32-perf" />
	</ant>
	<property file="${basedir}/win32-perf/testing.properties" />
	<delete file="${markerContainer}/${markerName}.marker" />
</target>
	
<target name="testLinuxGTKPerf">
	<property name="testResults" value="${postingDirectory}/${buildLabel}/performance" />
	<mkdir dir="${testResults}"/>
	<property name="markerName" value="eclipse30-linux-gtk-perf-${timestamp}" />
	<findMachine cfg="${cfg}" markerContainer="${markerContainer}" cfgKey="eclipse30LinuxGtkTestPerf" markerName="${markerName}" waitInterval="30"/>
	<property file="${markerContainer}/${markerName}.marker" />
	<property name="testMachine" value="${0}" />
		
	<ant antfile="${test.xml}">
		<property name="tester" value="${basedir}/rhelws3-linux-gtk-perf" />
	</ant>
		
	<delete file="${markerContainer}/${markerName}.marker" />
</target>

	<target name="testWinXPPerf2">
		<property name="testResults" value="${postingDirectory}/${buildLabel}/performance" />
		<mkdir dir="${testResults}"/>
		<property name="markerName" value="eclipse30-winxp-perf2-${timestamp}" />
		<findMachine cfg="${cfg}" markerContainer="${markerContainer}" cfgKey="eclipse30WinXPTestPerf2" markerName="${markerName}" waitInterval="30"/>
		<property file="${markerContainer}/${markerName}.marker" />
		<property name="testMachine" value="${0}" />
		<ant antfile="${test.xml}">
			<property name="tester" value="${basedir}/win32-perf2" />
		</ant>
		<property file="${basedir}/win32-perf2/testing.properties" />
		<delete file="${markerContainer}/${markerName}.marker" />
	</target>
		
	<target name="testLinuxGTKPerf2">
		<property name="testResults" value="${postingDirectory}/${buildLabel}/performance" />
		<mkdir dir="${testResults}"/>
		<property name="markerName" value="eclipse30-linux-gtk-perf2-${timestamp}" />
		<findMachine cfg="${cfg}" markerContainer="${markerContainer}" cfgKey="eclipse30LinuxGtkTestPerf2" markerName="${markerName}" waitInterval="30"/>
		<property file="${markerContainer}/${markerName}.marker" />
		<property name="testMachine" value="${0}" />
			
		<ant antfile="${test.xml}">
			<property name="tester" value="${basedir}/rhelws3-linux-gtk-perf2" />
		</ant>
			
		<delete file="${markerContainer}/${markerName}.marker" />
	</target>
</project>