<project name="Eclipse Test Configuration" default="performanceTests" basedir=".">

	<property name="markerContainer" value="/home/users/releng/buildTools/markers" />
	<property name="cfg" value="${markerContainer}/machinetest.cfg" />
	<property name="test.xml" value="${basedir}/../../../org.eclipse.releng.basebuilder/plugins/org.eclipse.build.tools/scripts/test.xml" />

	<target name="test">
		<findMachine cfg="${cfg}" markerContainer="${markerContainer}" cfgKey="${cfgKey}" markerName="${markerName}" waitInterval="30" />
		<property file="${markerContainer}/${markerName}.marker" />
		<property name="testMachine" value="${0}" />
		<ant antfile="${test.xml}">
			<property name="tester" value="${basedir}/${tester}" />
		</ant>
		<delete file="${markerContainer}/${markerName}.marker" />
	</target>

	<target name="performanceTests">
		<condition property="213">
			<equals arg1="${mapVersionTag}" arg2="perf_213" />
		</condition>
		<!--will only test target matching -->
		<parallel>
			<antcall target="testAll213" />
			<antcall target="testAll" />
		</parallel>
	</target>

	<target name="testAll213" if="213">
		<parallel>
			<!--slow machines-->
			<antcall target="test">
				<param name="tester" value="${basedir}/win32-perf" />
				<param name="cfgKey" value="eclipse30WinXPTestPerf" />
				<param name="markerName" value="eclipse213-winxp-perf-${timestamp}" />
			</antcall>
			<antcall target="test">
				<param name="tester" value="${basedir}/rhelws3-linux-gtk-perf" />
				<param name="cfgKey" value="eclipse30LinuxGtkTestPerf" />
				<param name="markerName" value="eclipse213-linux-perf-${timestamp}" />
			</antcall>
			<!--fast machines-->
			<antcall target="test">
				<param name="tester" value="${basedir}/win32-perf" />
				<param name="cfgKey" value="eclipse30WinXPTestPerf2" />
				<param name="markerName" value="eclipse213-winxp-perf2-${timestamp}" />
			</antcall>
			<antcall target="test">
				<param name="tester" value="${basedir}/rhelws3-linux-gtk-perf" />
				<param name="cfgKey" value="eclipse30LinuxGtkTestPerf2" />
				<param name="markerName" value="eclipse213-linux-perf2-${timestamp}" />
			</antcall>
		</parallel>
	</target>

	<target name="testAll">
		<parallel>
			<!--slow machines-->
			<antcall target="test">
				<param name="tester" value="${basedir}/win32-perf" />
				<param name="cfgKey" value="eclipse30WinXPTestPerf" />
				<param name="markerName" value="eclipse30-winxp-perf-${timestamp}" />
			</antcall>
			<antcall target="test">
				<param name="tester" value="${basedir}/rhelws3-linux-gtk-perf" />
				<param name="cfgKey" value="eclipse30LinuxGtkTestPerf" />
				<param name="markerName" value="eclipse30-linux-perf-${timestamp}" />
			</antcall>
			<!--fast machines-->
			<antcall target="test">
				<param name="tester" value="${basedir}/win32-perf" />
				<param name="cfgKey" value="eclipse30WinXPTestPerf2" />
				<param name="markerName" value="eclipse30-winxp-perf2-${timestamp}" />
			</antcall>
			<antcall target="test">
				<param name="tester" value="${basedir}/rhelws3-linux-gtk-perf" />
				<param name="cfgKey" value="eclipse30LinuxGtkTestPerf2" />
				<param name="markerName" value="eclipse30-linux-perf2-${timestamp}" />
			</antcall>
		</parallel>
	</target>

</project>