<project name="Customized testing instructions" default="customSetup">

	<target name="customSetup">
		<antcall target="installVm" />
		<!--copy the script which sets up environment and invokes the tests on test machine-->
		<chmod file="${tester}/testAll.sh" perm="755" />
		<exec dir="." executable="${copyClient}">
			<arg line="${tester}/testAll.sh ${testMachine}:${executionDir}" />
		</exec>
		
		<!--copy in test script modified for running Team CVS tests-->
		<exec dir="." executable="${copyClient}">
			<arg line="${tester}/../../testScripts/test.xml ${testMachine}:${executionDir}" />
		</exec>
		<condition property="buildRelease" value="3.0_200406251208">
			<equals arg1="${testedBuildId}" arg2="3.0"/>
		</condition>
		<condition property="buildRelease" value="3.0.1_200409161125">
			<equals arg1="${testedBuildId}" arg2="3.0.1"/>
		</condition>
		<condition property="buildRelease" value="3.0.2_">
			<equals arg1="${mapVersionTag}" arg2="3.0.2_200503110845"/>
		</condition>
		<condition property="buildRelease" value="2.1.3_200403101828">
			<equals arg1="${testedBuildId}" arg2="2.1.3"/>
		</condition>

		<replace file="${tester}/vm.properties" token="@buildType@@timestamp@" value="${buildRelease}_${timestamp}"/>

		<!--copy in the properties file for testing with performance vm args-->	
		<exec dir="." executable="${copyClient}">
			<arg line="${tester}/vm.properties ${testMachine}:${executionDir}" />
		</exec>
		
		<!--copy in the extra binaries needed to run tests-->	
		<exec dir="." executable="${copyClient}">
			<arg line="-r ${extraBinariesDir} ${testMachine}:${testDir}" />
		</exec>
		
		<!--add Cloudscape to junit test zip if it is available-->
		<available file="${internalPlugins}/Cloudscape" type="dir" property="Cloudscape.available" />
		<antcall target="installCloudscape" />
	</target>
	
	<target name="installCloudscape" if="Cloudscape.available">
		<mkdir dir="${tester}/eclipse/plugins" />
		<copy todir="${tester}/eclipse/plugins">
			<fileset dir="${internalPlugins}" includes="Cloudscape/**" />
		</copy>
		<exec dir="${tester}" executable="${copyClient}">
				<arg line="-r eclipse ${testMachine}:${executionDir}" />
		</exec>
	</target>
	
	<target name="installVm">
		<property name="testVmTag" value="HEAD" />
		<!--get and install the vm to test with-->
		<cvs cvsRoot="${cvsRoot}"
        	 command="export -r ${testVmTag} ${vmUrl}"
        	 dest="${tester}"
  		/>
	
		<exec dir="${tester}" executable="${copyClient}">
			<arg line="${vmUrl} ${testMachine}:${testDir}" />
		</exec>
	
		<exec dir="." executable="${loginClient}">
			<arg line="${testMachine} ${vmInstallCommand}" />
		</exec>
	</target>

</project>